{"version":3,"sources":["../../src/components/metrics.js"],"names":[],"mappings":";;;;;;;;;;;;;;;AACO,O;;AACC,mB,wCAAA,a;;;;;;;;;;;;;;;;;;;;;iCAEK,e;AAEX,iCAAY,UAAZ,EAAwB,aAAxB,EAAsC;AAAA;;AACpC,eAAK,UAAL,GAAkB,UAAlB;AACA,cAAI,MAAM,IAAI,aAAJ,CAAkB,UAAlB,EAA8B,aAA9B,CAAV;AACA,eAAK,WAAL,GAAmB,IAAI,oBAAJ,EAAnB;AACA,eAAK,MAAL,GAAc,KAAK,WAAL,CAAiB,CAAjB,CAAd;AACA,eAAK,gBAAL;AACD;;;;6CAEiB;AAAA;;AAChB,oBAAQ,GAAR,CAAY,qBAAZ;AACA,iBAAK,UAAL,CAAgB,GAAhB,CAAoB,KAAK,OAAL,CAAa,KAAK,MAAL,CAAY,QAAzB,CAApB,EAAwD,IAAxD,CACE,oBAAY;AACV,oBAAK,OAAL,GAAe,MAAK,iBAAL,CAAuB,SAAS,OAAhC,CAAf;AACD,aAHH;AAID;;;4CAEiB,O,EAAQ;AACxB,gBAAI,MAAM,EAAV;AACA,cAAE,IAAF,CAAO,OAAP,EAAgB,UAAS,KAAT,EAAgB,GAAhB,EAAoB;AAClC,kBAAI,SAAS,EAAb;AACA,qBAAO,MAAP,GAAgB,MAAM,MAAtB;AACA,qBAAO,IAAP,GAAc,EAAd;AACA,gBAAE,GAAF,CAAM,MAAM,IAAZ,EAAkB,UAAS,GAAT,EAAc,GAAd,EAAkB;;;;;AAKlC,oBAAI,OAAO,EAAE,SAAF,CAAY,OAAO,IAAnB,EAAyB,EAAC,QAAQ,IAAI,GAAb,EAAzB,CAAX;AACA,oBAAI,OAAJ;AACA,oBAAI,QAAQ,CAAC,CAAb,EAAgB;AACd,4BAAU,EAAC,MAAM,EAAP,EAAW,QAAQ,EAAnB,EAAV;AACD,iBAFD,MAEO;AACL,4BAAU,OAAO,IAAP,CAAY,IAAZ,CAAV;AACD;AACD,wBAAQ,MAAR,CAAe,IAAf,CAAoB,IAAI,KAAxB;AACA,wBAAQ,MAAR,GAAiB,EAAE,MAAF,CAAS,EAAE,IAAF,CAAO,QAAQ,MAAf,CAAT,CAAjB;AACA,wBAAQ,IAAR,GAAe,IAAI,GAAnB;AACA,oBAAI,OAAO,CAAC,CAAZ,EAAe;AACb,yBAAO,IAAP,CAAY,IAAZ,IAAoB,OAApB;AACD,iBAFD,MAEO;AACL,yBAAO,IAAP,CAAY,IAAZ,CAAiB,OAAjB;AACD;AACF,eApBiB,CAoBhB,IApBgB,CAoBX,MApBW,CAAlB;AAqBA,qBAAO,IAAP,GAAc,EAAE,MAAF,CAAS,OAAO,IAAhB,EAAsB,MAAtB,CAAd;AACA,kBAAI,IAAJ,CAAS,MAAT;AACD,aA3Be,CA2Bd,IA3Bc,CA2BT,GA3BS,CAAhB;;AA6BA,mBAAO,EAAE,MAAF,CAAS,GAAT,EAAc,QAAd,CAAP;AACD;;;kCAEO,Q,EAAS;AACf,mBAAO,aAAW,SAAS,UAApB,GAA+B,GAA/B,GAAmC,SAAS,SAA5C,GAAsD,cAA7D;AACD;;;;;;;;AAGH,sBAAgB,WAAhB,GAA8B,yBAA9B","file":"metrics.js","sourcesContent":["\nimport _ from 'lodash';\nimport {AuthsPageCtrl} from 'plugins/timely-app/components/authspage';\n\nexport class MetricsPageCtrl {\n\n  constructor(backendSrv, datasourceSrv){\n    this.backendSrv = backendSrv;\n    var apc = new AuthsPageCtrl(backendSrv, datasourceSrv);\n    this.datasources = apc.getTimelyDatasources();\n    this.source = this.datasources[0];\n    this.updateDatasource();\n  }\n\n  updateDatasource(){\n    console.log('updating datasource')\n    this.backendSrv.get(this._getURI(this.source.jsonData)).then(\n      response => {\n        this.metrics = this._transformMetrics(response.metrics);\n      });\n  }\n\n  _transformMetrics(metrics){\n    var ret = [];\n    _.each(metrics, function(value, idx){\n      var metric = {};\n      metric.metric = value.metric;\n      metric.tags = [];\n      _.map(value.tags, function(tag, key){\n//        result || (result = {});\n//        result['name'] = tag.key;\n//        result['values'] || (result['values'] = []);\n//        result['values'].push(tag.value);\n        var gIdx = _.findIndex(metric.tags, {'name': tag.key});\n        var grouped;\n        if( gIdx == -1 ){\n          grouped = {name: '', values: []};\n        } else {\n          grouped = metric.tags[gIdx];\n        }\n        grouped.values.push(tag.value);\n        grouped.values = _.sortBy(_.uniq(grouped.values))\n        grouped.name = tag.key;\n        if( gIdx > -1 ){\n          metric.tags[gIdx] = grouped;\n        } else {\n          metric.tags.push(grouped);\n        }\n      }.bind(metric));\n      metric.tags = _.sortBy(metric.tags, 'name')\n      ret.push(metric);\n    }.bind(ret));\n\n    return _.sortBy(ret, 'metric');\n  }\n\n  _getURI(jsonData){\n    return 'https://'+jsonData.timelyHost+':'+jsonData.httpsPort+'/api/metrics'\n  }\n\n}\nMetricsPageCtrl.templateUrl = 'components/metrics.html';\n"]}