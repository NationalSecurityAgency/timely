{"version":3,"sources":["../../src/components/auths.js"],"names":[],"mappings":"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","file":"auths.js","sourcesContent":["import _ from 'lodash';\n\nexport class AuthsCtrl {\n\n  constructor(backendSrv, $rootScope, $timeout){\n    this.$rootScope = $rootScope;\n    this.$timeout = $timeout;\n    this.backendSrv = backendSrv;\n  }\n\n  login(datasource){\n    this.fetching = {};\n    this.fetching.done = false;\n    this.fetching.show = true;\n    this.fetching.status = 'warning';\n    this.fetching.title = 'Fetching auths...';\n\n    //this.$rootScope.appEvent('alert-success', ['Authorization Cookie Received', '']);\n    //this.$rootScope.appEvent('alert-error', ['Authorization Failed', '']);\n    //this.$rootScope.appEvent('alert-warning', ['Fetching Authorizations', '']);\n\n    var uri = this._getURI(datasource.jsonData);\n\n    if(datasource.jsonData.basicAuths){\n      if( this.basicAuthUser && this.basicAuthPassword){\n        var authBlob = {username: this.basicAuthUser, password: this.basicAuthPassword};\n        this.doPostLogin(uri, authBlob);\n      } else {\n        this.$rootScope.appEvent('alert-warning', [datasource.name, 'requires User/Password']);\n        this.fetching.status = 'warning';\n        this.fetching.title = 'User/Password required';\n\n        return;\n      }\n    } else {\n      this.doGetLogin(uri);\n    }\n\n  }\n\n  doPostLogin(uri, authBlob){\n    this.doXHR('POST', uri, authBlob);\n  }\n\n  doGetLogin(uri){\n    this.doXHR('GET', uri)\n  }\n\n  doXHR(verb, uri, data){\n    if( !data){\n      data = \"\";\n    }\n    var r = new XMLHttpRequest();\n    r.open(verb, uri, true);\n    r.withCredentials = true;\n    r.setRequestHeader('Content-Type', 'application/json');\n    r.onreadystatechange = function () {\n      this.handleLoginResult(r);\n    }.bind(this);\n    r.send(JSON.stringify(data));\n  }\n\n  handleLoginResult(response){\n    // wait for readyState to be '4 => done'\n    if (response.readyState != 4) return;\n\n    this.fetching.done = true;\n\n    switch(response.status){\n      case 200:\n        var cookie = (document.cookie.match(/^(?:.*;)?TSESSIONID=([^;]+)(?:.*)?$/)||[,null])[1]\n        console.log(cookie);\n        console.log(document.cookie);\n        \n        this.fetching.status = 'success';\n        this.fetching.title = 'Login successful';\n        this.$rootScope.appEvent('alert-success', ['Success', '']);\n        break;\n      default:\n        this.fetching.status = 'warning';\n        this.fetching.title = response.statusText;\n        this.$rootScope.appEvent('alert-warning', [response.status+': '+response.statusText,'']);\n        break;\n    }\n\n    if (r.readyState != 4 || r.status != 200) return;\n    alert(\"Success: \" + r.getResponseHeader('Set-Cookie'));\n  }\n\n  _getURI(jsonData){\n    return 'https://'+jsonData.timelyHost+':'+jsonData.httpsPort+'/login'\n  }\n\n  _showResults(){\n\n  }\n}\n"]}